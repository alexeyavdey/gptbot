# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è JSON –≤ TaskSelectorAgent

## –ü—Ä–æ–±–ª–µ–º–∞ ‚ùå

### –û—à–∏–±–∫–∞ –≤ –ª–æ–≥–µ:
```
ERROR:gptbot:Error in TaskSelectorAgent: 'Input to ChatPromptTemplate is missing variables {\'\\n    "task_id"\'}.  Expected: [\'\\n  "task_id"\'}.  Expected: [\'\\n    "task_id"\'] Received: []
```

### –°–∏–º–ø—Ç–æ–º—ã:
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–¥–∞—á –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ("—É —Ç–µ–±—è –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏")
- LangChain –æ—à–∏–±–∫–∏ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö

## –ü—Ä–∏—á–∏–Ω–∞

### 1. –ù–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö
**–ü—Ä–æ–±–ª–µ–º–∞**: –í `TaskSelectorAgent.analyze_user_intent()` JSON –∑–∞–¥–∞—á –¥–æ–±–∞–≤–ª—è–ª—Å—è –≤ –ø—Ä–æ–º–ø—Ç –±–µ–∑ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:

```python
# –ü–†–û–ë–õ–ï–ú–ù–´–ô –ö–û–î:
analysis_prompt = f"""
–°–ü–ò–°–û–ö –ó–ê–î–ê–ß:
{json.dumps(tasks_info, ensure_ascii=False, indent=2)}  # ‚Üê –ù–µ—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON
"""
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: JSON —Å–æ–¥–µ—Ä–∂–∞–ª `"task_id": "uuid"`, –∞ LangChain –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞–ª `{task_id}` –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —à–∞–±–ª–æ–Ω–∞.

### 2. –ù–µ—Ç–æ—á–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞**: –ó–∞–ø—Ä–æ—Å "–∫–∞–∫–∏–µ —É –º–µ–Ω—è –µ—Å—Ç—å –∑–∞–¥–∞—á–∏" —Ä–æ—É—Ç–∏–ª—Å—è –∫ AI_MENTOR –≤–º–µ—Å—Ç–æ TASK_MANAGEMENT.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚úÖ

### 1. –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ JSON –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö

```python
# –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–û–î:
# –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º JSON —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ LangChain
tasks_json = json.dumps(tasks_info, ensure_ascii=False, indent=2).replace('{', '{{').replace('}', '}}')

analysis_prompt = f"""
–°–û–û–ë–©–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø: {user_message}

–°–ü–ò–°–û–ö –ó–ê–î–ê–ß:
{tasks_json}  # ‚Üê –¢–µ–ø–µ—Ä—å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω

–ö–û–ù–¢–ï–ö–°–¢ –†–ê–ó–ì–û–í–û–†–ê:
{context_info}

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤–µ—Ä–Ω–∏ JSON —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∞–Ω–∞–ª–∏–∑–∞.
"""
```

### 2. –£–ª—É—á—à–µ–Ω–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥ OrchestratorAgent

```python
–í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê –†–û–£–¢–ò–ù–ì–ê:
- "—Å–æ–∑–¥–∞—Ç—å/–¥–æ–±–∞–≤–∏—Ç—å/—Å–¥–µ–ª–∞—Ç—å –∑–∞–¥–∞—á—É" ‚Üí TASK_MANAGEMENT
- "–ø–æ–∫–∞–∑–∞—Ç—å/—Å–ø–∏—Å–æ–∫/–∫–∞–∫–∏–µ –∑–∞–¥–∞—á–∏" ‚Üí TASK_MANAGEMENT  # ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
- "—É–¥–∞–ª–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–¥–∞—á—É" ‚Üí TASK_MANAGEMENT
- "—Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞—á/—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" ‚Üí TASK_MANAGEMENT
- "–∫–∞–∫ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è/—Å–æ–≤–µ—Ç—ã/–ø–æ–º–æ—â—å" ‚Üí AI_MENTOR
- "—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí NOTIFICATIONS
- "–≤–µ—á–µ—Ä–Ω–∏–π —Ç—Ä–µ–∫–µ—Ä" ‚Üí EVENING_TRACKER
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```json
[
  {
    "task_id": "uuid",
    "title": "–°–¥–µ–ª–∞—Ç—å –±—ç–∫–ª–æ–≥"
  }
]
```
LangChain –≤–∏–¥–µ–ª `{task_id}` –∫–∞–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é ‚Üí **–û–®–ò–ë–ö–ê**

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```json
[
  {{
    "task_id": "uuid", 
    "title": "–°–¥–µ–ª–∞—Ç—å –±—ç–∫–ª–æ–≥"
  }}
]
```
LangChain –≤–∏–¥–µ–ª `{{task_id}}` –∫–∞–∫ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç ‚Üí **–û–ö**

## –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### ‚úÖ –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á**: "–¥–∞–≤–∞–π —Å–æ–∑–¥–∞–¥–∏–º –∑–∞–¥–∞—á—É" ‚Üí TaskManagementAgent
2. **–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–¥–∞—á**: "–∫–∞–∫–∏–µ —É –º–µ–Ω—è –µ—Å—Ç—å –∑–∞–¥–∞—á–∏" ‚Üí TaskManagementAgent  
3. **–ê–Ω–∞–ª–∏–∑ –Ω–∞–º–µ—Ä–µ–Ω–∏–π**: TaskSelectorAgent –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –æ—à–∏–±–æ–∫
4. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥**: –ó–∞–ø—Ä–æ—Å—ã –æ –∑–∞–¥–∞—á–∞—Ö –ø–æ–ø–∞–¥–∞—é—Ç –∫ –Ω—É–∂–Ω–æ–º—É –∞–≥–µ–Ω—Ç—É

### üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞–ª–æ:
- ‚úÖ JSON —É—Å–ø–µ—à–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç—Å—è (—Ñ–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏ —É–¥–≤–∞–∏–≤–∞—é—Ç—Å—è)
- ‚úÖ –ü—Ä–æ–º–ø—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- ‚úÖ –ù–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Ä–æ—É—Ç–∏–Ω–≥–∞ —á–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –∞–≥–µ–Ω—Ç–∞

## –î–∏–∞–ª–æ–≥ –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å

### –ò—Å—Ö–æ–¥–Ω—ã–π –ø—Ä–æ–±–ª–µ–º–Ω—ã–π –¥–∏–∞–ª–æ–≥:
```
üë§ "–∫–∞–∫–∏–µ —É –º–µ–Ω—è –µ—Å—Ç—å –∑–∞–¥–∞—á–∏"
‚ùå ERROR: TaskSelectorAgent JSON variables error
ü§ñ "—É —Ç–µ–±—è –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏" (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç)
```

### –û–∂–∏–¥–∞–µ–º—ã–π –¥–∏–∞–ª–æ–≥ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
üë§ "–∫–∞–∫–∏–µ —É –º–µ–Ω—è –µ—Å—Ç—å –∑–∞–¥–∞—á–∏"  
üîÄ OrchestratorAgent ‚Üí –ø—Ä–∞–≤–∏–ª–∞ —Ä–æ—É—Ç–∏–Ω–≥–∞ ‚Üí TASK_MANAGEMENT
üß† TaskSelectorAgent ‚Üí –∞–Ω–∞–ª–∏–∑ —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º JSON ‚Üí —É—Å–ø–µ—Ö
üìã TaskManagementAgent ‚Üí –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
ü§ñ "üìã –£ –≤–∞—Å –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏:
     1. üî• –°–¥–µ–ª–∞—Ç—å –±—ç–∫–ª–æ–≥ (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)"
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å—É—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ö–æ–Ω—Ñ–ª–∏–∫—Ç —à–∞–±–ª–æ–Ω–æ–≤ LangChain:
```python
# LangChain –∏—â–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ñ–∏–≥—É—Ä–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö {}
prompt_template = "–ó–∞–¥–∞—á–∞: {task_name}"  # –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è

# –ù–æ JSON —Ç–æ–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏
json_data = '{"task_id": "123"}'  # LangChain –¥—É–º–∞–µ—Ç —á—Ç–æ {task_id} - –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è

# –†–µ—à–µ–Ω–∏–µ: —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ JSON
escaped_json = '{{"task_id": "123"}}'  # LangChain –ø–æ–Ω–∏–º–∞–µ—Ç —á—Ç–æ —ç—Ç–æ —Ç–µ–∫—Å—Ç
```

### –ó–∞–º–µ–Ω–∞ –≤ –∫–æ–¥–µ:
```python
# –û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å—é –ø—Ä–æ–±–ª–µ–º—É:
tasks_json = json.dumps(tasks_info, ensure_ascii=False, indent=2).replace('{', '{{').replace('}', '}}')
```

## –°—Ç–∞—Ç—É—Å

‚úÖ **–û—Å–Ω–æ–≤–Ω–∞—è –æ—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞**: JSON –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç—Å—è  
‚úÖ **–†–æ—É—Ç–∏–Ω–≥ —É–ª—É—á—à–µ–Ω**: –ó–∞–ø—Ä–æ—Å—ã –æ –∑–∞–¥–∞—á–∞—Ö –ø–æ–ø–∞–¥–∞—é—Ç –∫ TASK_MANAGEMENT
‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ**: –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
üîÑ **–¢—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±–æ—Ç–µ**: –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ –∑–∞–¥–∞—á–∞—Ö –±–µ–∑ –æ—à–∏–±–æ–∫ LangChain!